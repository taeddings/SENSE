============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0 -- /data/data/com.termux/files/usr/bin/python3
cachedir: .pytest_cache
rootdir: /data/data/com.termux/files/home/project/SENSE/SENSE
plugins: anyio-4.9.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 72 items

tests/test_protocol.py::TestConstants::test_header_size PASSED           [  1%]
tests/test_protocol.py::TestConstants::test_magic_signature PASSED       [  2%]
tests/test_protocol.py::TestConstants::test_protocol_version PASSED      [  4%]
tests/test_protocol.py::TestDRGNHeader::test_create_header PASSED        [  5%]
tests/test_protocol.py::TestDRGNHeader::test_pack_unpack_roundtrip PASSED [  6%]
tests/test_protocol.py::TestDRGNHeader::test_invalid_signature_error PASSED [  8%]
tests/test_protocol.py::TestDRGNHeader::test_incomplete_header_error PASSED [  9%]
tests/test_protocol.py::TestDRGNHeader::test_message_too_large_error PASSED [ 11%]
tests/test_protocol.py::TestDRGNHeader::test_with_crc32 PASSED           [ 12%]
tests/test_protocol.py::TestDRGNHeader::test_verify_crc32 PASSED         [ 13%]
tests/test_protocol.py::TestBinaryParser::test_read_fixed_values PASSED  [ 15%]
tests/test_protocol.py::TestBinaryParser::test_read_bytes_zero_copy PASSED [ 16%]
tests/test_protocol.py::TestBinaryParser::test_read_string PASSED        [ 18%]
tests/test_protocol.py::TestBinaryParser::test_bounds_checking PASSED    [ 19%]
tests/test_protocol.py::TestBinaryParser::test_peek_doesnt_advance PASSED [ 20%]
tests/test_protocol.py::TestBinaryParser::test_skip PASSED               [ 22%]
tests/test_protocol.py::TestBinaryParser::test_seek PASSED               [ 23%]
tests/test_protocol.py::TestBinaryParser::test_sub_parser PASSED         [ 25%]
tests/test_protocol.py::TestBufferBuilder::test_build_simple_buffer PASSED [ 26%]
tests/test_protocol.py::TestBufferBuilder::test_write_string_with_length_prefix PASSED [ 27%]
tests/test_protocol.py::TestBufferBuilder::test_builder_size_tracking PASSED [ 29%]
tests/test_protocol.py::TestSerializers::test_json_serializer_roundtrip PASSED [ 30%]
tests/test_protocol.py::TestSerializers::test_json_serializer_handles_bytes PASSED [ 31%]
tests/test_protocol.py::TestSerializers::test_string_serializer PASSED   [ 33%]
tests/test_protocol.py::TestSerializers::test_msgpack_serializer_roundtrip SKIPPED [ 34%]
tests/test_protocol.py::TestSerializers::test_compression PASSED         [ 36%]
tests/test_protocol.py::TestSENSEMessage::test_create_request PASSED     [ 37%]
tests/test_protocol.py::TestSENSEMessage::test_create_response PASSED    [ 38%]
tests/test_protocol.py::TestSENSEMessage::test_message_roundtrip PASSED  [ 40%]
tests/test_protocol.py::TestSENSEMessage::test_crc_verification PASSED   [ 41%]
tests/test_protocol.py::TestSENSEMessage::test_lazy_payload_parsing PASSED [ 43%]
tests/test_protocol.py::TestSENSEMessage::test_error_response PASSED     [ 44%]
tests/test_protocol.py::TestSENSEMessage::test_try_parse_incomplete PASSED [ 45%]
tests/test_protocol.py::TestSENSEMessage::test_try_parse_complete PASSED [ 47%]
tests/test_protocol.py::TestMessageIdGeneration::test_unique_ids PASSED  [ 48%]
tests/test_protocol.py::TestMessageIdGeneration::test_auto_id_in_request PASSED [ 50%]
tests/test_protocol.py::TestPingPong::test_create_ping PASSED            [ 51%]
tests/test_protocol.py::TestPingPong::test_create_pong PASSED            [ 52%]
tests/test_protocol.py::TestEdgeCases::test_empty_payload PASSED         [ 54%]
tests/test_protocol.py::TestEdgeCases::test_string_payload PASSED        [ 55%]
tests/test_protocol.py::TestEdgeCases::test_large_payload PASSED         [ 56%]
tests/test_protocol.py::TestEdgeCases::test_nested_payload PASSED        [ 58%]
tests/test_protocol.py::TestCRC32::test_compute_crc32 PASSED             [ 59%]
tests/test_protocol.py::TestCRC32::test_verify_crc32 PASSED              [ 61%]
tests/test_engram_manager.py::TestEngramManager::test_open_and_close PASSED [ 62%]
tests/test_engram_manager.py::TestEngramManager::test_get_parser FAILED  [ 63%]
tests/test_engram_manager.py::TestEngramManager::test_get_slice FAILED   [ 65%]
tests/test_engram_manager.py::TestEngramManager::test_read_at PASSED     [ 66%]
tests/test_engram_manager.py::TestEngramManager::test_find_pattern PASSED [ 68%]
tests/test_engram_manager.py::TestEngramManager::test_buffer_not_open_error PASSED [ 69%]
tests/test_engram_manager.py::TestEngramManager::test_file_not_found PASSED [ 70%]
tests/test_engram_manager.py::TestEngramManager::test_parser_with_offset FAILED [ 72%]
tests/test_engram_manager.py::TestEngramManager::test_resource_cleanup_on_error PASSED [ 73%]
tests/test_engram_manager.py::TestEngramManager::test_memoryview_zero_copy FAILED [ 75%]
tests/test_engram_manager.py::TestMultiBufferManager::test_open_multiple_buffers PASSED [ 76%]
tests/test_engram_manager.py::TestMultiBufferManager::test_get_parsers FAILED [ 77%]
tests/test_engram_manager.py::TestMultiBufferManager::test_resource_cleanup PASSED [ 79%]
tests/test_engram_manager.py::TestAsyncEngramManager::test_async_open_close PASSED [ 80%]
tests/test_engram_manager.py::TestAsyncEngramManager::test_async_read_at PASSED [ 81%]
tests/test_engram_manager.py::TestAsyncEngramManager::test_get_parser_sync FAILED [ 83%]
tests/test_engram_manager.py::TestAsyncEngramManager::test_get_view FAILED [ 84%]
tests/test_engram_manager.py::TestUtilityFunctions::test_create_buffer_file PASSED [ 86%]
tests/test_engram_manager.py::TestUtilityFunctions::test_create_buffer_file_with_fill PASSED [ 87%]
tests/test_engram_manager.py::TestUtilityFunctions::test_verify_buffer_integrity_exists PASSED [ 88%]
tests/test_engram_manager.py::TestUtilityFunctions::test_verify_buffer_integrity_not_exists PASSED [ 90%]
tests/test_engram_manager.py::TestUtilityFunctions::test_verify_buffer_integrity_with_magic PASSED [ 91%]
tests/test_engram_manager.py::TestEdgeCases::test_empty_file PASSED      [ 93%]
tests/test_engram_manager.py::TestEdgeCases::test_very_small_file PASSED [ 94%]
tests/test_engram_manager.py::TestEdgeCases::test_read_beyond_buffer FAILED [ 95%]
tests/test_engram_manager.py::TestEdgeCases::test_concurrent_managers_same_file PASSED [ 97%]
tests/test_engram_manager.py::TestParserIntegration::test_parser_reads_all_data FAILED [ 98%]
tests/test_engram_manager.py::TestParserIntegration::test_parser_position_tracking FAILED [100%]

=================================== FAILURES ===================================
______________________ TestEngramManager.test_get_parser _______________________
tests/test_engram_manager.py:82: in test_get_parser
    with EngramManager(temp_buffer_file) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
_______________________ TestEngramManager.test_get_slice _______________________
tests/test_engram_manager.py:92: in test_get_slice
    with EngramManager(temp_buffer_file) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
__________________ TestEngramManager.test_parser_with_offset ___________________
tests/test_engram_manager.py:132: in test_parser_with_offset
    with EngramManager(temp_buffer_file) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
_________________ TestEngramManager.test_memoryview_zero_copy __________________
tests/test_engram_manager.py:157: in test_memoryview_zero_copy
    with EngramManager(temp_buffer_file) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
___________________ TestMultiBufferManager.test_get_parsers ____________________
tests/test_engram_manager.py:182: in test_get_parsers
    with MultiBufferManager(temp_buffer_files) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:282: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
_________________ TestAsyncEngramManager.test_get_parser_sync __________________
tests/test_engram_manager.py:221: in test_get_parser_sync
    async with AsyncEngramManager(temp_buffer_file) as manager:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:351: in __aexit__
    await loop.run_in_executor(
../../../../usr/lib/python3.12/concurrent/futures/thread.py:59: in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:353: in <lambda>
    lambda: self._manager.__exit__(exc_type, exc_val, exc_tb)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
_____________________ TestAsyncEngramManager.test_get_view _____________________
tests/test_engram_manager.py:229: in test_get_view
    async with AsyncEngramManager(temp_buffer_file) as manager:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:351: in __aexit__
    await loop.run_in_executor(
../../../../usr/lib/python3.12/concurrent/futures/thread.py:59: in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:353: in <lambda>
    lambda: self._manager.__exit__(exc_type, exc_val, exc_tb)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
____________________ TestEdgeCases.test_read_beyond_buffer _____________________
tests/test_engram_manager.py:305: in test_read_beyond_buffer
    with EngramManager(temp_buffer_file) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
_______________ TestParserIntegration.test_parser_reads_all_data _______________
tests/test_engram_manager.py:326: in test_parser_reads_all_data
    with EngramManager(temp_buffer_file) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
_____________ TestParserIntegration.test_parser_position_tracking ______________
tests/test_engram_manager.py:340: in test_parser_position_tracking
    with EngramManager(temp_buffer_file) as manager:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sense_v2/engram/manager.py:168: in __exit__
    return self._exit_stack.__exit__(exc_type, exc_val, exc_tb)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:610: in __exit__
    raise exc_details[1]
../../../../usr/lib/python3.12/contextlib.py:595: in __exit__
    if cb(*exc_details):
       ^^^^^^^^^^^^^^^^
../../../../usr/lib/python3.12/contextlib.py:478: in _exit_wrapper
    callback(*args, **kwds)
E   BufferError: cannot close exported pointers exist
=========================== short test summary info ============================
FAILED tests/test_engram_manager.py::TestEngramManager::test_get_parser - Buf...
FAILED tests/test_engram_manager.py::TestEngramManager::test_get_slice - Buff...
FAILED tests/test_engram_manager.py::TestEngramManager::test_parser_with_offset
FAILED tests/test_engram_manager.py::TestEngramManager::test_memoryview_zero_copy
FAILED tests/test_engram_manager.py::TestMultiBufferManager::test_get_parsers
FAILED tests/test_engram_manager.py::TestAsyncEngramManager::test_get_parser_sync
FAILED tests/test_engram_manager.py::TestAsyncEngramManager::test_get_view - ...
FAILED tests/test_engram_manager.py::TestEdgeCases::test_read_beyond_buffer
FAILED tests/test_engram_manager.py::TestParserIntegration::test_parser_reads_all_data
FAILED tests/test_engram_manager.py::TestParserIntegration::test_parser_position_tracking
=================== 10 failed, 61 passed, 1 skipped in 5.39s ===================
